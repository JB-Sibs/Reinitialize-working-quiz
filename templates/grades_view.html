{% extends 'taskbar.html' %}
{% load static %}

<div class="main-content">
    {% block content %}
    <div class="container mt-4">
        <!-- Student View -->
        {% if user.is_student %}
        <h2>Quiz Scores</h2>
        <table class="table table-bordered mt-3">
            <thead>
                <tr>
                    <th>Quiz Name</th>
                    <th>Score</th>
                </tr>
            </thead>
            <tbody>
                {% for result in results %}
                <tr>
                    <td>{{ result.quiz__name }}</td>
                    <td>{{ result.score }}</td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="2" class="text-center">No quiz results available.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        <h2>Exam Scores</h2>
        <table class="table table-bordered mt-3">
            <thead>
                <tr>
                    <th>Exam Name</th>
                    <th>Score</th>
                    <th>Total Items</th>
                    <th>Date Taken</th>
                </tr>
            </thead>
            <tbody>
                {% for exam in exam_results %}
                <tr>
                    <td>{{ exam.exam_name }}</td>
                    <td>{{ exam.score }}</td>
                    <td>{{ exam.total_items }}</td>
                    <td>{{ exam.date_taken }}</td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="4" class="text-center">No exam results available.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% endif %}

        <!-- Professor View -->
        {% if user.is_professor %}
        <h2>Quiz Scores (All Students)</h2>
        <table class="table table-bordered mt-3">
            <thead>
                <tr>
                    <th>Student Name</th>
                    <th>Quiz Name</th>
                    <th>Score</th>
                    <th>Passed</th>
                </tr>
            </thead>
            <tbody>
                {% for result in results_prof %}
                <tr>
                    <td>{{ result.user__username }}</td>
                    <td>{{ result.quiz__name }}</td>
                    <td>{{ result.score }}</td>
                    <td>{{ result.passed|yesno:"Yes,No" }}</td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="4" class="text-center">No quiz results available.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        <h2>Exam Scores (All Students)</h2>
        <table class="table table-bordered mt-3">
            <thead>
                <tr>
                    <th>Student Name</th>
                    <th>Exam Name</th>
                    <th>Score</th>
                    <th>Total Items</th>
                    <th>Date Taken</th>
                </tr>
            </thead>
            <tbody>
                {% for exam in exam_results_prof %}
                <tr>
                    <td>{{ exam.student }}</td>
                    <td>{{ exam.exam_name }}</td>
                    <td>{{ exam.score }}</td>
                    <td>{{ exam.total_items }}</td>
                    <td>{{ exam.date_taken }}</td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="5" class="text-center">No exam results available.</td>
                </tr>
                    
                {% endfor %}
            </tbody>
        </table>
            <!-- Add exam results button for professors -->
    <a href="{% url 'class:add_exam_result' obj.pk %}">
        <button type="button" class="custom-btn">Add exam results</button>
    </a>

        <!-- Student Grades Overview (Professors) -->
      <div class="grades-card">
    <h3>Student Grades Overview</h3>
    <table class="table table-bordered mt-3">
        <thead>
            <tr>
                <th>Student Name</th>
                <th>Prelim Grade</th>
                <th>Midterm Grade</th>
                <th>Final Grade</th>
                <th>Average</th>
            </tr>
        </thead>
        <tbody>
            {% for grade in student_grades %}
                <!-- Avoid showing professor's own grades -->
                {% if not grade.student.username == user.username %}
                <tr>
                    <td>{{ grade.student.username }}</td>
                    <td>{{ grade.prelim_final|floatformat:"2" }}</td>
                    <td>{{ grade.midterm_final|floatformat:"2" }}</td>
                    <td>{{ grade.final_final|floatformat:"2" }}</td>
                    <td>{{ grade.final_grade_average|floatformat:"2" }}</td>
                </tr>
                {% endif %}
            {% empty %}
            <tr>
                <td colspan="5" class="text-center">No grades available for students.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
        {% endif %}
    </div>
    {% endblock %}
</div>